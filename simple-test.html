<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•APIæµ‹è¯•</title>
    <script>
        window._AMapSecurityConfig = {
            securityJsCode: "db2b6cf5ae4f82ee233b1abe16aa459a",
        }
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 300px; }
        #map { width: 100%; height: 300px; border: 1px solid #ddd; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª é«˜å¾·åœ°å›¾APIç®€å•æµ‹è¯•</h1>
        
        <div>
            <h3>1. è®¾ç½®APIå¯†é’¥</h3>
            <input type="password" id="apiKey" placeholder="è¾“å…¥APIå¯†é’¥">
            <button onclick="loadAPI()">åŠ è½½API</button>
            <div id="apiResult" class="result">è¯·å…ˆè¾“å…¥APIå¯†é’¥å¹¶ç‚¹å‡»åŠ è½½</div>
        </div>

        <div>
            <h3>2. æµ‹è¯•åœ°å›¾</h3>
            <button onclick="testMap()">åˆ›å»ºåœ°å›¾</button>
            <div id="map"></div>
            <div id="mapResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>

        <div>
            <h3>3. æµ‹è¯•å®šä½</h3>
            <button onclick="testLocation()">è·å–ä½ç½®</button>
            <div id="locationResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>

        <div>
            <h3>4. æµ‹è¯•è·¯çº¿è§„åˆ’</h3>
            <input type="text" id="origin" placeholder="èµ·ç‚¹" value="åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å®‰é—¨å¹¿åœº">
            <input type="text" id="destination" placeholder="ç»ˆç‚¹" value="åŒ—äº¬å¸‚è¥¿åŸåŒºåŒ—äº¬è¥¿ç«™">
            <button onclick="testRoute()">è§„åˆ’è·¯çº¿</button>
            <div id="routeResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>
    </div>

    <script>
        let AMap;
        let map;

        function loadAPI() {
            const key = document.getElementById('apiKey').value.trim();
            const result = document.getElementById('apiResult');
            
            if (!key) {
                result.innerHTML = 'âŒ è¯·è¾“å…¥APIå¯†é’¥';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨åŠ è½½...';
            result.className = 'result';

            // ç§»é™¤æ—§è„šæœ¬
            const old = document.querySelector('script[src*="webapi.amap.com"]');
            if (old) old.remove();

            const script = document.createElement('script');
            script.src = `https://webapi.amap.com/maps?v=1.4.15&key=${key}`;
            
            script.onload = () => {
                if (window.AMap) {
                    AMap = window.AMap;
                    result.innerHTML = 'âœ… APIåŠ è½½æˆåŠŸï¼ç°åœ¨å¯ä»¥æµ‹è¯•å…¶ä»–åŠŸèƒ½äº†';
                    result.className = 'result success';
                } else {
                    result.innerHTML = 'âŒ APIå¯¹è±¡æœªæ‰¾åˆ°';
                    result.className = 'result error';
                }
            };
            
            script.onerror = () => {
                result.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•åŠ è½½API';
                result.className = 'result error';
            };
            
            document.head.appendChild(script);
        }

        function testMap() {
            const result = document.getElementById('mapResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            try {
                map = new AMap.Map('map', {
                    zoom: 11,
                    center: [116.397428, 39.90923]
                });
                
                result.innerHTML = 'âœ… åœ°å›¾åˆ›å»ºæˆåŠŸï¼';
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = 'âŒ åœ°å›¾åˆ›å»ºå¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }

        function testLocation() {
            const result = document.getElementById('locationResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨å®šä½...ï¼ˆè¯·å…è®¸ä½ç½®æƒé™ï¼‰';
            result.className = 'result';

            // å…ˆå°è¯•IPå®šä½ï¼ˆæ›´ç¨³å®šï¼‰
            AMap.plugin('AMap.CitySearch', function() {
                const citySearch = new AMap.CitySearch();
                citySearch.getLocalCity(function(status, cityResult) {
                    if (status === 'complete' && cityResult.info === 'OK') {
                        result.innerHTML = `âœ… IPå®šä½æˆåŠŸï¼
åŸå¸‚: ${cityResult.city}
çœä»½: ${cityResult.province}`;
                        result.className = 'result success';
                    } else {
                        // IPå®šä½å¤±è´¥ï¼Œå°è¯•GPSå®šä½
                        AMap.plugin('AMap.Geolocation', function() {
                            const geo = new AMap.Geolocation({
                                enableHighAccuracy: false,
                                timeout: 10000
                            });
                            
                            geo.getCurrentPosition(function(geoStatus, geoResult) {
                                if (geoStatus === 'complete') {
                                    result.innerHTML = `âœ… GPSå®šä½æˆåŠŸï¼
åœ°å€: ${geoResult.formattedAddress || 'æœªçŸ¥'}
åæ ‡: ${geoResult.position.lng}, ${geoResult.position.lat}`;
                                    result.className = 'result success';
                                } else {
                                    result.innerHTML = `âŒ å®šä½å¤±è´¥
å¯èƒ½åŸå› ï¼š
1. å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢äº†è¯·æ±‚
2. æ²¡æœ‰ä½ç½®æƒé™
3. ç½‘ç»œè¿æ¥é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼š
1. å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨
2. å…è®¸ä½ç½®æƒé™
3. æ£€æŸ¥ç½‘ç»œè¿æ¥`;
                                    result.className = 'result error';
                                }
                            });
                        });
                    }
                });
            });
        }

        function testRoute() {
            const result = document.getElementById('routeResult');
            const origin = document.getElementById('origin').value.trim();
            const destination = document.getElementById('destination').value.trim();

            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            if (!origin || !destination) {
                result.innerHTML = 'âŒ è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨è§„åˆ’è·¯çº¿...';
            result.className = 'result';

            // æ–¹æ³•1: ç›´æ¥ä½¿ç”¨å…³é”®å­—æœç´¢ï¼ˆæ¨èï¼‰
            AMap.plugin('AMap.Driving', function() {
                const driving = new AMap.Driving({
                    map: map,
                    panel: null
                });

                // ä½¿ç”¨å®˜æ–¹æ–‡æ¡£æ¨èçš„æ ¼å¼ï¼š[{keyword:'èµ·ç‚¹',city:'åŸå¸‚'},{keyword:'ç»ˆç‚¹',city:'åŸå¸‚'}]
                const points = [
                    {keyword: origin, city: 'åŒ—äº¬'},
                    {keyword: destination, city: 'åŒ—äº¬'}
                ];

                driving.search(points, function(status, routeResult) {
                    if (status === 'complete' && routeResult.routes && routeResult.routes.length > 0) {
                        const route = routeResult.routes[0];
                        result.innerHTML = `âœ… è·¯çº¿è§„åˆ’æˆåŠŸï¼
èµ·ç‚¹: ${routeResult.start ? routeResult.start.name : origin}
ç»ˆç‚¹: ${routeResult.end ? routeResult.end.name : destination}
è·ç¦»: ${(route.distance / 1000).toFixed(1)}å…¬é‡Œ
æ—¶é—´: ${Math.round(route.time / 60)}åˆ†é’Ÿ
è´¹ç”¨: Â¥${route.tolls || 0}
ç­–ç•¥: ${route.policy || 'é»˜è®¤'}`;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = `âŒ è·¯çº¿è§„åˆ’å¤±è´¥
çŠ¶æ€: ${status}
é”™è¯¯ä¿¡æ¯: ${routeResult ? (routeResult.info || 'æœªçŸ¥é”™è¯¯') : 'æ— å“åº”'}

å¯èƒ½åŸå› ï¼š
1. åœ°å€æ— æ³•è¯†åˆ«ï¼Œè¯·ä½¿ç”¨æ›´å…·ä½“çš„åœ°å€
2. APIå¯†é’¥æƒé™ä¸è¶³
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢äº†è¯·æ±‚

å»ºè®®ï¼š
- ä½¿ç”¨å®Œæ•´åœ°å€ï¼Œå¦‚"åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å®‰é—¨å¹¿åœº"
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦å¼€é€šäº†è·¯çº¿è§„åˆ’æœåŠ¡
- æš‚æ—¶å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨`;
                        result.className = 'result error';
                    }
                });
            });
        }
    </script>
</body>
</html>
