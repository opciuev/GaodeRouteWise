<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è·¯çº¿è§„åˆ’æµ‹è¯•</title>
    <script>
        window._AMapSecurityConfig = {
            securityJsCode: "db2b6cf5ae4f82ee233b1abe16aa459a",
        }
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; white-space: pre-wrap; }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 300px; }
        #map { width: 100%; height: 400px; border: 1px solid #ddd; margin: 10px 0; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ è·¯çº¿è§„åˆ’è¯¦ç»†æµ‹è¯•</h1>
        
        <div class="step">
            <h3>æ­¥éª¤1: åŠ è½½API</h3>
            <input type="password" id="apiKey" placeholder="è¾“å…¥APIå¯†é’¥">
            <button onclick="loadAPI()">åŠ è½½API</button>
            <div id="apiResult" class="result">è¯·è¾“å…¥APIå¯†é’¥</div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤2: åˆ›å»ºåœ°å›¾</h3>
            <button onclick="createMap()">åˆ›å»ºåœ°å›¾</button>
            <div id="map"></div>
            <div id="mapResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤3: æµ‹è¯•åœ°ç†ç¼–ç </h3>
            <input type="text" id="testAddress" value="åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å®‰é—¨å¹¿åœº" placeholder="æµ‹è¯•åœ°å€">
            <button onclick="testGeocode()">åœ°å€è§£æ</button>
            <div id="geocodeResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤4: æµ‹è¯•è·¯çº¿è§„åˆ’</h3>
            <input type="text" id="origin" value="åŒ—äº¬å¸‚ä¸œåŸåŒºå¤©å®‰é—¨å¹¿åœº" placeholder="èµ·ç‚¹">
            <input type="text" id="destination" value="åŒ—äº¬å¸‚è¥¿åŸåŒºåŒ—äº¬è¥¿ç«™" placeholder="ç»ˆç‚¹">
            <br>
            <button onclick="testRouteByAddress()">æŒ‰åœ°å€è§„åˆ’</button>
            <button onclick="testRouteByCoords()">æŒ‰åæ ‡è§„åˆ’</button>
            <button onclick="testAllMethods()">æµ‹è¯•æ‰€æœ‰æ–¹æ³•</button>
            <div id="routeResult" class="result">è¯·å…ˆåŠ è½½API</div>
        </div>
    </div>

    <script>
        let AMap;
        let map;

        function loadAPI() {
            const key = document.getElementById('apiKey').value.trim();
            const result = document.getElementById('apiResult');
            
            if (!key) {
                result.innerHTML = 'âŒ è¯·è¾“å…¥APIå¯†é’¥';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨åŠ è½½API...';
            result.className = 'result';

            const script = document.createElement('script');
            script.src = `https://webapi.amap.com/maps?v=1.4.15&key=${key}`;
            
            script.onload = () => {
                if (window.AMap) {
                    AMap = window.AMap;
                    result.innerHTML = 'âœ… APIåŠ è½½æˆåŠŸï¼';
                    result.className = 'result success';
                } else {
                    result.innerHTML = 'âŒ APIå¯¹è±¡æœªæ‰¾åˆ°';
                    result.className = 'result error';
                }
            };
            
            script.onerror = () => {
                result.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•åŠ è½½API';
                result.className = 'result error';
            };
            
            document.head.appendChild(script);
        }

        function createMap() {
            const result = document.getElementById('mapResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            try {
                map = new AMap.Map('map', {
                    zoom: 11,
                    center: [116.397428, 39.90923],
                    mapStyle: 'amap://styles/normal'
                });
                
                result.innerHTML = 'âœ… åœ°å›¾åˆ›å»ºæˆåŠŸï¼';
                result.className = 'result success';
            } catch (error) {
                result.innerHTML = 'âŒ åœ°å›¾åˆ›å»ºå¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }

        function testGeocode() {
            const address = document.getElementById('testAddress').value.trim();
            const result = document.getElementById('geocodeResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨è§£æåœ°å€...';
            result.className = 'result';

            AMap.plugin('AMap.Geocoder', function() {
                const geocoder = new AMap.Geocoder({
                    extensions: 'all'
                });
                
                geocoder.getLocation(address, function(status, geocodeResult) {
                    if (status === 'complete' && geocodeResult.geocodes.length) {
                        const location = geocodeResult.geocodes[0];
                        result.innerHTML = `âœ… åœ°å€è§£ææˆåŠŸï¼
åœ°å€: ${location.formattedAddress}
åæ ‡: ${location.location.lng}, ${location.location.lat}
çº§åˆ«: ${location.level}
è¯¦ç»†ä¿¡æ¯: ${JSON.stringify(location, null, 2)}`;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = `âŒ åœ°å€è§£æå¤±è´¥
çŠ¶æ€: ${status}
ç»“æœ: ${JSON.stringify(geocodeResult, null, 2)}`;
                        result.className = 'result error';
                    }
                });
            });
        }

        function testRouteByAddress() {
            const origin = document.getElementById('origin').value.trim();
            const destination = document.getElementById('destination').value.trim();
            const result = document.getElementById('routeResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨æŒ‰åœ°å€è§„åˆ’è·¯çº¿...';
            result.className = 'result';

            AMap.plugin('AMap.Driving', function() {
                const driving = new AMap.Driving({
                    map: map,
                    panel: null
                });
                
                driving.search([
                    {keyword: origin},
                    {keyword: destination}
                ], function(status, routeResult) {
                    result.innerHTML = `è·¯çº¿è§„åˆ’ç»“æœï¼ˆæŒ‰åœ°å€ï¼‰:
çŠ¶æ€: ${status}
ç»“æœ: ${JSON.stringify(routeResult, null, 2)}`;
                    
                    if (status === 'complete' && routeResult.routes && routeResult.routes.length > 0) {
                        const route = routeResult.routes[0];
                        result.innerHTML += `

âœ… è·¯çº¿è§„åˆ’æˆåŠŸï¼
è·ç¦»: ${(route.distance / 1000).toFixed(1)}å…¬é‡Œ
æ—¶é—´: ${Math.round(route.time / 60)}åˆ†é’Ÿ
è´¹ç”¨: Â¥${route.tolls || 0}`;
                        result.className = 'result success';
                    } else {
                        result.className = 'result error';
                    }
                });
            });
        }

        function testRouteByCoords() {
            const origin = document.getElementById('origin').value.trim();
            const destination = document.getElementById('destination').value.trim();
            const result = document.getElementById('routeResult');
            
            if (!AMap) {
                result.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                result.className = 'result error';
                return;
            }

            result.innerHTML = 'ğŸ”„ æ­£åœ¨æŒ‰åæ ‡è§„åˆ’è·¯çº¿...';
            result.className = 'result';

            // å…ˆè·å–åæ ‡
            AMap.plugin('AMap.Geocoder', function() {
                const geocoder = new AMap.Geocoder();
                
                geocoder.getLocation(origin, function(status1, result1) {
                    if (status1 === 'complete' && result1.geocodes.length) {
                        const originCoord = result1.geocodes[0].location;
                        
                        geocoder.getLocation(destination, function(status2, result2) {
                            if (status2 === 'complete' && result2.geocodes.length) {
                                const destCoord = result2.geocodes[0].location;
                                
                                // ä½¿ç”¨åæ ‡è§„åˆ’è·¯çº¿
                                AMap.plugin('AMap.Driving', function() {
                                    const driving = new AMap.Driving({
                                        map: map,
                                        panel: null
                                    });
                                    
                                    driving.search(originCoord, destCoord, function(status, routeResult) {
                                        result.innerHTML = `è·¯çº¿è§„åˆ’ç»“æœï¼ˆæŒ‰åæ ‡ï¼‰:
èµ·ç‚¹åæ ‡: ${originCoord.lng}, ${originCoord.lat}
ç»ˆç‚¹åæ ‡: ${destCoord.lng}, ${destCoord.lat}
çŠ¶æ€: ${status}
ç»“æœ: ${JSON.stringify(routeResult, null, 2)}`;
                                        
                                        if (status === 'complete' && routeResult.routes && routeResult.routes.length > 0) {
                                            const route = routeResult.routes[0];
                                            result.innerHTML += `

âœ… è·¯çº¿è§„åˆ’æˆåŠŸï¼
è·ç¦»: ${(route.distance / 1000).toFixed(1)}å…¬é‡Œ
æ—¶é—´: ${Math.round(route.time / 60)}åˆ†é’Ÿ
è´¹ç”¨: Â¥${route.tolls || 0}`;
                                            result.className = 'result success';
                                        } else {
                                            result.className = 'result error';
                                        }
                                    });
                                });
                            } else {
                                result.innerHTML = `âŒ ç»ˆç‚¹åœ°å€è§£æå¤±è´¥: ${destination}`;
                                result.className = 'result error';
                            }
                        });
                    } else {
                        result.innerHTML = `âŒ èµ·ç‚¹åœ°å€è§£æå¤±è´¥: ${origin}`;
                        result.className = 'result error';
                    }
                });
            });
        }

        function testAllMethods() {
            const result = document.getElementById('routeResult');
            result.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ‰€æœ‰è·¯çº¿è§„åˆ’æ–¹æ³•...';
            result.className = 'result';
            
            setTimeout(() => testRouteByAddress(), 100);
            setTimeout(() => testRouteByCoords(), 3000);
        }
    </script>
</body>
</html>
