<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜å¾·åœ°å›¾APIæµ‹è¯•</title>
    <script>
        window._AMapSecurityConfig = {
            securityJsCode: "db2b6cf5ae4f82ee233b1abe16aa459a",
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª é«˜å¾·åœ°å›¾APIåŠŸèƒ½æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•é«˜å¾·åœ°å›¾APIçš„å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>

        <!-- APIå¯†é’¥è®¾ç½® -->
        <div class="test-section">
            <h3>ğŸ”‘ APIå¯†é’¥è®¾ç½®</h3>
            <input type="password" id="api-key" placeholder="è¾“å…¥é«˜å¾·åœ°å›¾APIå¯†é’¥">
            <button onclick="loadAPI()">åŠ è½½API</button>
            <div id="api-result" class="result"></div>
        </div>

        <!-- åœ°å›¾åˆå§‹åŒ–æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ—ºï¸ åœ°å›¾åˆå§‹åŒ–æµ‹è¯•</h3>
            <button onclick="testMapInit()">åˆå§‹åŒ–åœ°å›¾</button>
            <div id="map-container" style="width: 100%; height: 300px; margin-top: 10px; border: 1px solid #ddd;"></div>
            <div id="map-result" class="result"></div>
        </div>

        <!-- å®šä½åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“ å®šä½åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="testGeolocation()">æµè§ˆå™¨å®šä½</button>
            <button onclick="testIPLocation()">IPå®šä½</button>
            <div id="location-result" class="result"></div>
        </div>

        <!-- åœ°ç†ç¼–ç æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” åœ°ç†ç¼–ç æµ‹è¯•</h3>
            <input type="text" id="address-input" placeholder="è¾“å…¥åœ°å€ï¼Œå¦‚ï¼šåŒ—äº¬å¤©å®‰é—¨" value="åŒ—äº¬å¤©å®‰é—¨">
            <button onclick="testGeocode()">åœ°å€è§£æ</button>
            <div id="geocode-result" class="result"></div>
        </div>

        <!-- è·¯çº¿è§„åˆ’æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸš— è·¯çº¿è§„åˆ’æµ‹è¯•</h3>
            <input type="text" id="origin-test" placeholder="èµ·ç‚¹" value="åŒ—äº¬å¤©å®‰é—¨">
            <input type="text" id="destination-test" placeholder="ç»ˆç‚¹" value="åŒ—äº¬è¥¿ç«™">
            <button onclick="testDriving()">é©¾è½¦è·¯çº¿</button>
            <button onclick="testWalking()">æ­¥è¡Œè·¯çº¿</button>
            <div id="route-result" class="result"></div>
        </div>
    </div>

    <script>
        let map;
        let AMap;

        // åŠ è½½é«˜å¾·åœ°å›¾API
        function loadAPI() {
            const apiKey = document.getElementById('api-key').value.trim();
            const resultDiv = document.getElementById('api-result');
            
            if (!apiKey) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥APIå¯†é’¥';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨åŠ è½½API...';
            resultDiv.className = 'result';

            // ç§»é™¤å·²å­˜åœ¨çš„è„šæœ¬
            const existingScript = document.querySelector('script[src*="webapi.amap.com"]');
            if (existingScript) {
                existingScript.remove();
            }

            const script = document.createElement('script');
            script.src = `https://webapi.amap.com/maps?v=1.4.15&key=${apiKey}`;
            
            script.onload = function() {
                if (window.AMap) {
                    AMap = window.AMap;
                    resultDiv.innerHTML = 'âœ… APIåŠ è½½æˆåŠŸï¼\né«˜å¾·åœ°å›¾JS API 1.4å·²å°±ç»ª';
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = 'âŒ APIåŠ è½½å¤±è´¥';
                    resultDiv.className = 'result error';
                }
            };
            
            script.onerror = function() {
                resultDiv.innerHTML = 'âŒ APIåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIå¯†é’¥';
                resultDiv.className = 'result error';
            };
            
            document.head.appendChild(script);
        }

        // æµ‹è¯•åœ°å›¾åˆå§‹åŒ–
        function testMapInit() {
            const resultDiv = document.getElementById('map-result');
            
            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            try {
                map = new AMap.Map('map-container', {
                    zoom: 11,
                    center: [116.397428, 39.90923],
                    mapStyle: 'amap://styles/normal'
                });

                resultDiv.innerHTML = 'âœ… åœ°å›¾åˆå§‹åŒ–æˆåŠŸï¼\nä¸­å¿ƒç‚¹: åŒ—äº¬å¤©å®‰é—¨\nç¼©æ”¾çº§åˆ«: 11';
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = 'âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ' + error.message;
                resultDiv.className = 'result error';
            }
        }

        // æµ‹è¯•æµè§ˆå™¨å®šä½
        function testGeolocation() {
            const resultDiv = document.getElementById('location-result');

            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è·å–ä½ç½®...\næç¤ºï¼šè¯·å…è®¸æµè§ˆå™¨è®¿é—®ä½ç½®æƒé™';
            resultDiv.className = 'result';

            AMap.plugin('AMap.Geolocation', function() {
                const geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0,
                    convert: true,
                    showButton: false,
                    showMarker: false,
                    showCircle: false
                });

                geolocation.getCurrentPosition(function(status, result) {
                    if (status === 'complete') {
                        const address = result.formattedAddress || 'åœ°å€è§£æä¸­...';
                        const lng = result.position ? result.position.lng : 'æœªçŸ¥';
                        const lat = result.position ? result.position.lat : 'æœªçŸ¥';
                        const accuracy = result.accuracy || 'æœªçŸ¥';

                        resultDiv.innerHTML = `âœ… æµè§ˆå™¨å®šä½æˆåŠŸï¼
ä½ç½®: ${address}
åæ ‡: ${lng}, ${lat}
ç²¾åº¦: ${accuracy}ç±³
å®šä½æ–¹å¼: ${result.location_type || 'GPS'}`;
                        resultDiv.className = 'result success';
                    } else {
                        let errorMsg = 'æœªçŸ¥é”™è¯¯';
                        if (result && result.message) {
                            errorMsg = result.message;
                        } else if (result && result.info) {
                            errorMsg = result.info;
                        }

                        resultDiv.innerHTML = `âŒ æµè§ˆå™¨å®šä½å¤±è´¥
é”™è¯¯ä¿¡æ¯: ${errorMsg}
å¯èƒ½åŸå› :
1. ç”¨æˆ·æ‹’ç»äº†ä½ç½®æƒé™
2. è®¾å¤‡ä¸æ”¯æŒå®šä½
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢äº†è¯·æ±‚

è§£å†³æ–¹æ¡ˆ:
1. æ£€æŸ¥æµè§ˆå™¨åœ°å€æ æ˜¯å¦æœ‰ä½ç½®æƒé™æç¤º
2. åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸æ­¤ç½‘ç«™è®¿é—®ä½ç½®
3. æš‚æ—¶å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨
4. å°è¯•ä½¿ç”¨HTTPSåè®®`;
                        resultDiv.className = 'result error';
                    }
                });
            });
        }

        // æµ‹è¯•IPå®šä½
        function testIPLocation() {
            const resultDiv = document.getElementById('location-result');

            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è·å–IPä½ç½®...';
            resultDiv.className = 'result';

            AMap.plugin('AMap.CitySearch', function() {
                const citySearch = new AMap.CitySearch();

                citySearch.getLocalCity(function(status, result) {
                    if (status === 'complete' && result.info === 'OK') {
                        resultDiv.innerHTML = `âœ… IPå®šä½æˆåŠŸï¼
åŸå¸‚: ${result.city || 'æœªçŸ¥'}
çœä»½: ${result.province || 'æœªçŸ¥'}
åŸå¸‚ç¼–ç : ${result.adcode || 'æœªçŸ¥'}
åæ ‡èŒƒå›´: ${result.rectangle || 'æœªçŸ¥'}`;
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.innerHTML = `âŒ IPå®šä½å¤±è´¥
çŠ¶æ€: ${status}
é”™è¯¯ä¿¡æ¯: ${result ? result.info || result.message || 'æœªçŸ¥é”™è¯¯' : 'æ— å“åº”'}

å¯èƒ½åŸå› :
1. å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢äº†è¯·æ±‚
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. APIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨

è§£å†³æ–¹æ¡ˆ:
1. æš‚æ—¶å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ç¨åé‡è¯•`;
                        resultDiv.className = 'result error';
                    }
                });
            });
        }

        // æµ‹è¯•åœ°ç†ç¼–ç 
        function testGeocode() {
            const address = document.getElementById('address-input').value.trim();
            const resultDiv = document.getElementById('geocode-result');
            
            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            if (!address) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥åœ°å€';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è§£æåœ°å€...';
            resultDiv.className = 'result';

            AMap.plugin('AMap.Geocoder', function() {
                const geocoder = new AMap.Geocoder();
                
                geocoder.getLocation(address, function(status, result) {
                    if (status === 'complete' && result.geocodes.length) {
                        const location = result.geocodes[0];
                        resultDiv.innerHTML = `âœ… åœ°å€è§£ææˆåŠŸï¼
åœ°å€: ${location.formattedAddress}
åæ ‡: ${location.location.lng}, ${location.location.lat}
çº§åˆ«: ${location.level}`;
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.innerHTML = `âŒ åœ°å€è§£æå¤±è´¥`;
                        resultDiv.className = 'result error';
                    }
                });
            });
        }

        // æµ‹è¯•é©¾è½¦è·¯çº¿
        function testDriving() {
            const origin = document.getElementById('origin-test').value.trim();
            const destination = document.getElementById('destination-test').value.trim();
            const resultDiv = document.getElementById('route-result');
            
            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            if (!origin || !destination) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è§„åˆ’é©¾è½¦è·¯çº¿...';
            resultDiv.className = 'result';

            AMap.plugin('AMap.Driving', function() {
                const driving = new AMap.Driving();
                
                driving.search([{keyword: origin}, {keyword: destination}], function(status, result) {
                    if (status === 'complete') {
                        const route = result.routes[0];
                        resultDiv.innerHTML = `âœ… é©¾è½¦è·¯çº¿è§„åˆ’æˆåŠŸï¼
è·ç¦»: ${(route.distance / 1000).toFixed(1)}å…¬é‡Œ
æ—¶é—´: ${Math.round(route.time / 60)}åˆ†é’Ÿ
è¿‡è·¯è´¹: Â¥${route.tolls || 0}`;
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.innerHTML = `âŒ é©¾è½¦è·¯çº¿è§„åˆ’å¤±è´¥`;
                        resultDiv.className = 'result error';
                    }
                });
            });
        }

        // æµ‹è¯•æ­¥è¡Œè·¯çº¿
        function testWalking() {
            const origin = document.getElementById('origin-test').value.trim();
            const destination = document.getElementById('destination-test').value.trim();
            const resultDiv = document.getElementById('route-result');
            
            if (!AMap) {
                resultDiv.innerHTML = 'âŒ è¯·å…ˆåŠ è½½API';
                resultDiv.className = 'result error';
                return;
            }

            if (!origin || !destination) {
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥èµ·ç‚¹å’Œç»ˆç‚¹';
                resultDiv.className = 'result error';
                return;
            }

            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è§„åˆ’æ­¥è¡Œè·¯çº¿...';
            resultDiv.className = 'result';

            AMap.plugin('AMap.Walking', function() {
                const walking = new AMap.Walking();
                
                walking.search([{keyword: origin}, {keyword: destination}], function(status, result) {
                    if (status === 'complete') {
                        const route = result.routes[0];
                        resultDiv.innerHTML = `âœ… æ­¥è¡Œè·¯çº¿è§„åˆ’æˆåŠŸï¼
è·ç¦»: ${(route.distance / 1000).toFixed(1)}å…¬é‡Œ
æ—¶é—´: ${Math.round(route.time / 60)}åˆ†é’Ÿ`;
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.innerHTML = `âŒ æ­¥è¡Œè·¯çº¿è§„åˆ’å¤±è´¥`;
                        resultDiv.className = 'result error';
                    }
                });
            });
        }
    </script>
</body>
</html>
